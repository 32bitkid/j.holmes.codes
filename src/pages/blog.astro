---
import { getCollection } from 'astro:content';
import Page from "@layouts/page.astro";
import BlogItem from "../components/BlogItem.astro";

const allBlogPosts =
  (await getCollection(
    'blog',
    ({ data }) => (import.meta.env.PROD) ? data.pubDate !== undefined : true,
  ))
  .sort((a, b) => {
      const aDate = a.data.authorDate ?? a.data.pubDate;
      const bDate = b.data.authorDate ?? b.data.pubDate;
      if (!aDate && !bDate) return 0;
      if (!aDate) return 1;
      if (!bDate) return -1;
      return bDate.getTime() - aDate.getTime();
  });
---
<Page title="Blog">
    <h1>All Posts</h1>
    <ul class="posts">
        {allBlogPosts.map((blog) => <BlogItem blog={blog} />)}
    </ul>
</Page>

<style>
    h1 {
        margin-bottom: var(--line-height);
    }
</style>